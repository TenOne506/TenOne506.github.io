<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.26" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.178" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/svg" href="/icons/spider-man.svg" sizes="16*16"><title>MapReduce | Zephyrus's Whisper</title><meta name="description" content="Zephyrus"><link rel="preload" href="/assets/style-BNLrsAsm.css" as="style"><link rel="stylesheet" href="/assets/style-BNLrsAsm.css"><link rel="modulepreload" href="/assets/app-BChvZF5M.js"><link rel="modulepreload" href="/assets/index.html-fAR1PbG6.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-9ec8d5cc><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-196de0c9></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-196de0c9> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-9ec8d5cc data-v-ec9ab87d><div class="vp-navbar" vp-navbar data-v-ec9ab87d data-v-24857a1c><div class="wrapper" data-v-24857a1c><div class="container" data-v-24857a1c><div class="title" data-v-24857a1c><div class="vp-navbar-title has-sidebar" data-v-24857a1c data-v-603d9c2d><a class="vp-link link no-icon title" href="/" data-v-603d9c2d><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/icons/spider-man.svg" alt data-v-8edbb2c2><!--]--><!--[--><img class="vp-image light logo" style="" src="/icons/spider-man.svg" alt data-v-8edbb2c2><!--]--><!--]--><!--]--><span data-v-603d9c2d>Zephyrus&#39;s Whisper</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-24857a1c><div class="content-body" data-v-24857a1c><!--[--><!--]--><div class="vp-navbar-search search" data-v-24857a1c><div class="search-wrapper" data-v-abf0dd27><!----><div id="local-search" data-v-abf0dd27><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-abf0dd27><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-24857a1c data-v-40161412><span id="main-nav-aria-label" class="visually-hidden" data-v-40161412>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><!----><span data-v-891e0319>首页</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><!----><span data-v-891e0319>博客</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/tips/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><!----><span data-v-891e0319>小技巧</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/searchengine/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><span class="vp-icon-img" aria-hidden data-v-891e0319 data-v-eacefbdd><img src="/icons/search.svg" alt="" style="" data-v-eacefbdd></span><span data-v-891e0319>搜索引擎</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/distsys/4t7c7m2q/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><span class="vp-icon vpi-pbx034x9" style="" aria-hidden data-provider="iconify" data-v-891e0319></span><span data-v-891e0319>分布式系统</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/compiler/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><span class="vp-icon-img" aria-hidden data-v-891e0319 data-v-eacefbdd><img src="/icons/compilerexplorer.svg" alt="" style="" data-v-eacefbdd></span><span data-v-891e0319>编译原理</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/code/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><span class="vp-icon-img" aria-hidden data-v-891e0319 data-v-eacefbdd><img src="/icons/code.svg" alt="" style="" data-v-eacefbdd></span><span data-v-891e0319>手撕算法题</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/interview/" tabindex="0" data-v-40161412 data-v-891e0319><!--[--><span class="vp-icon-img" aria-hidden data-v-891e0319 data-v-eacefbdd><img src="/icons/interview.svg" alt="" style="" data-v-eacefbdd></span><span data-v-891e0319>面试</span><!----><!--]--><!----></a><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-24857a1c data-v-cdfa9739><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-cdfa9739 data-v-505e2f02 data-v-6ada0279><span class="check" data-v-6ada0279><span class="icon" data-v-6ada0279><!--[--><span class="vpi-sun sun" data-v-505e2f02></span><span class="vpi-moon moon" data-v-505e2f02></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-24857a1c data-v-6e8304b1 data-v-d0f71cb7><!--[--><a class="vp-social-link no-icon" href="https://github.com/TenOne506/" aria-label="github" target="_blank" rel="noopener" data-v-d0f71cb7 data-v-031a95fa><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-24857a1c data-v-48a0d5b0 data-v-437935f4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-437935f4><span class="vpi-more-horizontal icon" data-v-437935f4></span></button><div class="menu" data-v-437935f4><div class="vp-menu" data-v-437935f4 data-v-264028f7><!----><!--[--><!--[--><!----><div class="group" data-v-48a0d5b0><div class="item appearance" data-v-48a0d5b0><p class="label" data-v-48a0d5b0>外观</p><div class="appearance-action" data-v-48a0d5b0><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-48a0d5b0 data-v-505e2f02 data-v-6ada0279><span class="check" data-v-6ada0279><span class="icon" data-v-6ada0279><!--[--><span class="vpi-sun sun" data-v-505e2f02></span><span class="vpi-moon moon" data-v-505e2f02></span><!--]--></span></span></button></div></div></div><div class="group" data-v-48a0d5b0><div class="item social-links" data-v-48a0d5b0><div class="vp-social-links social-links-list" data-v-48a0d5b0 data-v-d0f71cb7><!--[--><a class="vp-social-link no-icon" href="https://github.com/TenOne506/" aria-label="github" target="_blank" rel="noopener" data-v-d0f71cb7 data-v-031a95fa><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-24857a1c data-v-bb3cce7b><span class="container" data-v-bb3cce7b><span class="top" data-v-bb3cce7b></span><span class="middle" data-v-bb3cce7b></span><span class="bottom" data-v-bb3cce7b></span></span></button></div></div></div></div><div class="divider" data-v-24857a1c><div class="divider-line" data-v-24857a1c></div></div></div><!----></header><div class="vp-local-nav reached-top" data-v-9ec8d5cc data-v-bcf24e45><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-bcf24e45><span class="vpi-align-left menu-icon" data-v-bcf24e45></span><span class="menu-text" data-v-bcf24e45>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-bcf24e45 data-v-47d1cbdb><!----><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-9ec8d5cc data-v-1dd53143><div class="curtain" data-v-1dd53143></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-1dd53143><span id="sidebar-aria-label" class="visually-hidden" data-v-1dd53143> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9d721baa><section class="vp-sidebar-item sidebar-item level-0" data-v-9d721baa data-v-ca2820ff><!----><div data-v-ca2820ff data-v-ca2820ff><div class="items" data-v-ca2820ff><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-ca2820ff data-v-ca2820ff><div class="item" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><a class="vp-link link link" href="/distsys/4t7c7m2q/" data-v-ca2820ff><!--[--><p class="text" data-v-ca2820ff><span data-v-ca2820ff>README</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-9d721baa><section class="vp-sidebar-item sidebar-item level-0 collapsible has-active" data-v-9d721baa data-v-ca2820ff><div class="item" role="button" tabindex="0" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><h2 class="text" data-v-ca2820ff><span data-v-ca2820ff>论文</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ca2820ff><span class="vpi-chevron-right caret-icon" data-v-ca2820ff></span></div></div><div data-v-ca2820ff data-v-ca2820ff><div class="items" data-v-ca2820ff><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-ca2820ff data-v-ca2820ff><div class="item" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><a class="vp-link link link" href="/distsys/cv7rbt64/" data-v-ca2820ff><!--[--><p class="text" data-v-ca2820ff><span data-v-ca2820ff>容错虚拟机</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-ca2820ff data-v-ca2820ff><div class="item" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><a class="vp-link link link" href="/distsys/9ipo7yld/" data-v-ca2820ff><!--[--><p class="text" data-v-ca2820ff><span data-v-ca2820ff>MapReduce</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-ca2820ff data-v-ca2820ff><div class="item" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><a class="vp-link link link" href="/distsys/huqj63jd/" data-v-ca2820ff><!--[--><p class="text" data-v-ca2820ff><span data-v-ca2820ff>Raft</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-9d721baa><section class="vp-sidebar-item sidebar-item level-0 collapsible collapsed" data-v-9d721baa data-v-ca2820ff><div class="item" role="button" tabindex="0" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><h2 class="text" data-v-ca2820ff><span data-v-ca2820ff>分布式基础理论</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ca2820ff><span class="vpi-chevron-right caret-icon" data-v-ca2820ff></span></div></div><div style="display:none;" data-v-ca2820ff data-v-ca2820ff><div class="items" data-v-ca2820ff><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-ca2820ff data-v-ca2820ff><div class="item" data-v-ca2820ff><div class="indicator" data-v-ca2820ff></div><!----><a class="vp-link link link" href="/distsys/4via9eso/" data-v-ca2820ff><!--[--><p class="text" data-v-ca2820ff><span data-v-ca2820ff>分布式行为</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-9ec8d5cc data-v-5e3b3f3e><div class="vp-doc-container has-sidebar has-aside" data-v-5e3b3f3e data-v-2cd3122f><!--[--><!--]--><div class="container" data-v-2cd3122f><div class="aside" vp-outline data-v-2cd3122f><div class="aside-curtain" data-v-2cd3122f></div><div class="aside-container" data-v-2cd3122f><div class="aside-content" data-v-2cd3122f><div class="vp-doc-aside" data-v-2cd3122f data-v-3561741f><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-3561741f data-v-137e0069><div class="content" data-v-137e0069><div class="outline-marker" data-v-137e0069></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-137e0069><span data-v-137e0069>此页内容</span><span class="vpi-print icon" data-v-137e0069></span></div><ul class="root" data-v-137e0069 data-v-cb76ecae><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3561741f></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-2cd3122f><div class="content-container" data-v-2cd3122f><!--[--><!--]--><main class="main" data-v-2cd3122f><nav class="vp-breadcrumb" data-v-2cd3122f data-v-7107be77><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-7107be77><!--[--><li property="itemListElement" typeof="ListItem" data-v-7107be77><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-7107be77><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-7107be77></span><meta property="name" content="首页" data-v-7107be77><meta property="position" content="1" data-v-7107be77></li><li property="itemListElement" typeof="ListItem" data-v-7107be77><span class="vp-link breadcrumb" property="item" typeof="WebPage" data-v-7107be77><!--[-->分布式系统<!--]--><!----></span><span class="vpi-chevron-right" data-v-7107be77></span><meta property="name" content="分布式系统" data-v-7107be77><meta property="position" content="2" data-v-7107be77></li><li property="itemListElement" typeof="ListItem" data-v-7107be77><a class="vp-link link breadcrumb current" href="/distsys/9ipo7yld/" property="item" typeof="WebPage" data-v-7107be77><!--[-->MapReduce<!--]--><!----></a><!----><meta property="name" content="MapReduce" data-v-7107be77><meta property="position" content="3" data-v-7107be77></li><!--]--></ol></nav><!--[--><!--]--><!--[--><div class="vp-doc-title" data-v-dfe9df06><!--[--><!--]--><h1 class="page-title" data-v-dfe9df06><!----> MapReduce <!----></h1><!--[--><!--]--></div><div class="vp-doc-meta" data-v-dfe9df06><!--[--><!--]--><p class="reading-time" data-v-dfe9df06><span class="vpi-books icon" data-v-dfe9df06></span><span data-v-dfe9df06>约 2926 字</span><span data-v-dfe9df06>大约 10 分钟</span></p><!----><!--[--><!--]--><p class="create-time" data-v-dfe9df06><span class="vpi-clock icon" data-v-dfe9df06></span><span data-v-dfe9df06>2025-11-27</span></p></div><!--]--><!--[--><!--]--><div class="_distsys_9ipo7yld_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-2cd3122f><!--[--><!--]--><div data-v-2cd3122f><h3 id="mapreduce" tabindex="-1"><a class="header-anchor" href="#mapreduce"><span>MapReduce</span></a></h3><p>MapReduce 是一种分布式计算模型，它将一个计算任务分解为多个子任务，并使用多个节点来执行这些子任务。MapReduce 的主要优点是它可以处理大型数据集，并自动处理数据分片和合并。</p><p>对当时的谷歌来说，这个计算模型最大的好处是可以运行在廉价的集群上面，来进行分布式的计算。</p><p>以我本科时候大数据的实验为例，还能在网盘中找到。简单来说就是map和reduce两个函数，map函数将数据会生成多个中间的KV键值对，然后reduce函数将键值对进行合并。可以参考下面的代码。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">//context 是mapper任务的上下文</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">protected</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> map</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">Object</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> key</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> value</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> Context</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> context)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">{</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">    String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> line </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;"> value</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">toString</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">();</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">    String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">[] vals </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;"> line</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">split</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;">&quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#EEF0F9;">\t</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;">&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">);</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">//以制表符为界</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">    String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> uid </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> vals[</span><span style="--shiki-light:#1976D2;--shiki-dark:#FFD493;">1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">//用户id</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">    String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> search </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> vals[</span><span style="--shiki-light:#1976D2;--shiki-dark:#FFD493;">2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">//搜索关键词</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;">    context</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">write</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">(uid)</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">(search</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;">&quot;|||&quot;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;">search</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">length</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">())</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">protected</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> reduce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> key</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> Iterable</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">Text</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> values</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> Context</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> context)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">    String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> result </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;"> &quot;&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">    for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">Text</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> value </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> values) {</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">        String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> strVal </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;"> value</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">toString</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">();</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">        result </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> (strVal</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;">&quot; &quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">    }</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;">    context</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">write</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">(key </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;"> &quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#EEF0F9;">\t</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">)</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> Text</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">(result)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">);</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">注</p><p>尽管前面的伪代码使用字符串作为输入和输出，但从概念上讲，用户提供的 map 和 reduce 函数具有相应的类型：</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-plain"><span class="line"><span>map(k1, v1) → list(k2, v2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>reduce(k2, list(v2)) → list(v2)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>map 输出的 value 类型，必须和 reduce 函数接收的 value 类型一样； 但 reduce 最后写出去的 value，可以换成别的类型（比如把 整数 汇总成 字符串 ）。</p></div><p><img src="/distsys/mapreduce/mrarc.png" alt="center" style="display:block;margin-left:auto;margin-right:auto;"></p><p>Google 的 MapReduce 系统跑在大量廉价、易坏的普通机器上，用便宜硬盘存数据，靠复制防丢，靠调度器自动分任务，整个系统设计目标是：低成本、高容错、可扩展。</p><p>具体的执行过程如下：</p><ol><li>用户程序启动时，MapReduce 库首先将输入数据划分为若干逻辑分片（通常每片大小为 16–64 MB，可由用户配置），随后在集群中启动多个进程副本以并行执行任务。</li><li>其中一个副本作为主节点（master），其余作为工作节点（worker）。主控负责任务调度：它将整个作业划分为 M 个 map 任务和 R 个 reduce 任务，并动态分配给空闲的工作节点。</li><li>被分配 map 任务的工作节点读取对应的输入分片，解析出键值对，并将其传递给用户定义的 map 函数。map 函数生成的中间键值对暂存于内存缓冲区中。</li><li>当缓冲区达到阈值时，中间结果会按分区函数（partition function）被划分成 R 个区域（对应 R 个 reduce 任务），并批量写入本地磁盘。写入完成后，该节点将这些中间文件的位置信息上报给主控，由主控转发给相应的 reduce 工作节点。</li><li>各 reduce 工作节点通过远程读取（remote read）从所有完成 map 任务的节点拉取其所属分区的中间数据。数据全部获取后，reduce 节点按中间键进行排序，使得相同键的所有值连续排列；若数据量超出内存容量，则采用外部排序机制。</li><li>随后，reduce 节点遍历排序后的数据，对每个唯一键及其对应的值列表调用用户提供的 reduce 函数。reduce 的输出结果被追加至最终的输出文件中，每个 reduce 任务生成一个独立的输出文件（共 R 个）。</li><li>当所有 map 任务和 reduce 任务均执行完毕后，主节点唤醒用户程序。此时，用户代码中调用的 MapReduce 接口返回，控制权重新移交至用户程序的后续逻辑。</li></ol><h3 id="容错处理" tabindex="-1"><a class="header-anchor" href="#容错处理"><span>容错处理</span></a></h3><p>主节点，记录(idle, in-progress,or completed)这样的数据结构，并且识别集群中有没有坏掉的机器。</p><h4 id="工作节点故障" tabindex="-1"><a class="header-anchor" href="#工作节点故障"><span>工作节点故障</span></a></h4><p>主节点会定期向工作节点发送心跳探测，确保在线。并作为中间数据的调度中枢：每当一个 map 任务完成，主节点便记录其生成的 R 个中间文件分区的位置和大小，并将这些元数据增量推送给正在执行 reduce 任务的工作节点。</p><p>已完成的 map 任务在节点故障后需要重新执行，因为其输出结果存储在故障机器的本地磁盘上，无法访问。而已完成的 reduce 任务则无需重试，因为其输出结果存储在全局分布式文件系统中，具有高可用性。</p><p>这里注意是成功之后，发生了故障，如果在之前故障，map 或 reduce 都是失败的任务，再重新执行。</p><h4 id="主节点故障" tabindex="-1"><a class="header-anchor" href="#主节点故障"><span>主节点故障</span></a></h4><p>主节点可以轻松地定期将其上述数据结构写入检查点（checkpoint）。如果主任务意外终止，系统可从最后一个检查点状态恢复并启动新的主控实例。我记得在当下hadoop的实践中，会有SecondNameNode进行替代，在其他分布式实践中，会重新推举主节点。</p><h4 id="数据局部性" tabindex="-1"><a class="header-anchor" href="#数据局部性"><span>数据局部性</span></a></h4><p>GFS 将每个文件划分为 64 MB 的块，并在不同机器上保存每个块的多个副本（通常为 3 副本）。MapReduce 主节点会获取输入文件的副本位置信息。如如果出现故障，主节点会尝试在最近的故障附近副本进行低哦阿杜工作。当在集群中大量工作节点上运行大规模 MapReduce 作业时，绝大多数输入数据可在本地读取，从而无需消耗网络带宽。</p><h4 id="任务粒度" tabindex="-1"><a class="header-anchor" href="#任务粒度"><span>任务粒度</span></a></h4><p>我们将 map 阶段划分为 M 个片段，reduce 阶段划分为 R 个片段，如前所述。理想情况下，M 和 R 应远大于工作节点的数量。在实现中，M 和 R 的大小存在实际限制，因为主节点需要做出 O(M + R) 次调度决策，并在内存中维护 O(M × R) 的状态信息（如上所述）。尽管内存使用中的常数因子较小（每对 map/reduce 任务的状态仅需约 1 字节数据），但该开销仍需考虑。谷歌的实际案例，在 2,000 台工作节点上执行 MapReduce 计算，采用 M = 200,000 和 R = 5,000 的配置。</p><h4 id="备份任务" tabindex="-1"><a class="header-anchor" href="#备份任务"><span>备份任务</span></a></h4><p>MapReduce 会出现严重的尾延迟现象，map或reduce任务出现异常，耗时增加会拖慢整个计算。例如，硬盘存在故障的机器可能会频繁发生可纠正错误，导致其读取性能从 30 MB/s 降至 1 MB/s。集群调度系统可能已在该机器上运行了其他任务，造成 CPU、内存、本地磁盘或网络带宽的竞争，从而减缓 MapReduce 代码的执行速度。我们近期遇到的一个问题是：机器初始化代码中存在一个缺陷，导致处理器缓存被禁用，受影响机器上的计算速度下降超过一百倍。</p><p>为缓解拖后腿问题，谷歌设计了一种通用机制：当 MapReduce 操作接近完成时，主节点会为剩余的未完成任务启动备份执行。只要主任务或备份任务中任意一个完成，该任务即被标记为完成。</p><h3 id="优化与拓展" tabindex="-1"><a class="header-anchor" href="#优化与拓展"><span>优化与拓展</span></a></h3><h4 id="分区函数-partitioning-function" tabindex="-1"><a class="header-anchor" href="#分区函数-partitioning-function"><span>分区函数（Partitioning Function）</span></a></h4><p>MapReduce 允许用户指定 reduce 任务数 ( R )，并通过分区函数将中间键分配到对应的 reduce 任务。默认使用 hash(key) mod R 实现均匀负载，但支持自定义分区逻辑（如按 URL 主机哈希），以满足特定数据局部性或输出组织需求。</p><h4 id="排序保证-ordering-guarantees" tabindex="-1"><a class="header-anchor" href="#排序保证-ordering-guarantees"><span>排序保证（Ordering Guarantees）</span></a></h4><p>系统保证每个 reduce 分区内，中间键值对按键升序处理。这使得每个输出文件天然有序，便于后续高效随机访问或满足应用对结果顺序的要求。</p><h4 id="合并函数-combiner-function" tabindex="-1"><a class="header-anchor" href="#合并函数-combiner-function"><span>合并函数（Combiner Function）</span></a></h4><p>为减少网络传输开销，MapReduce 支持在 map 端本地执行 combiner（合并函数），对具有相同键的中间结果进行预聚合。combiner 通常复用 reduce 函数逻辑，但仅作用于本地数据，适用于满足交换律与结合律的操作（如求和、计数）。典型应用包括词频统计中大幅压缩 &lt;word, 1&gt; 的传输量。</p><h4 id="输入与输出类型-input-and-output-types" tabindex="-1"><a class="header-anchor" href="#输入与输出类型-input-and-output-types"><span>输入与输出类型（Input and Output Types）</span></a></h4><p>默认文本模式以“偏移量”为键、“行内容”为值；支持按键排序的键值对格式；输入可被合理划分成 map 任务范围（如避免跨行切分）；用户可通过实现 reader 接口自定义输入源（如数据库、内存结构）。支持多种输出格式，用户可扩展新类型，便于适配不同下游系统需求。</p><h4 id="副作用-side-effects" tabindex="-1"><a class="header-anchor" href="#副作用-side-effects"><span>副作用(side-effects)</span></a></h4><p>MapReduce 允许任务产生额外输出，但要求用户自行保证这些操作的安全性（原子 + 幂等），框架不提供跨文件事务支持。</p><h4 id="跳过坏的记录" tabindex="-1"><a class="header-anchor" href="#跳过坏的记录"><span>跳过坏的记录</span></a></h4><p>为应对因用户代码 bug（如第三方库崩溃）导致 MapReduce 任务反复失败的问题，系统提供一种容错执行模式：工作节点通过信号处理器捕获崩溃，并上报出错记录的序列号；主节点识别重复失败的记录后，在后续重试中自动跳过该记录；从而在无法修复代码的情况下，仍能完成对大规模数据集的近似处理。</p><h4 id="debug" tabindex="-1"><a class="header-anchor" href="#debug"><span>debug</span></a></h4><p>在集群中debug是非常困难的，因此开发了本地运行的MapReduce库，帮助开发者进行debug。</p><h4 id="状态信息-status-information" tabindex="-1"><a class="header-anchor" href="#状态信息-status-information"><span>状态信息(status information)</span></a></h4><p>MapReduce 主节点通过内置 HTTP 服务提供可视化状态页面，实时展示作业进度、资源使用情况和任务执行状态，并提供日志链接与故障信息，使用户能够监控作业运行、预估完成时间、判断是否需扩容，同时在出现异常时快速定位问题根源，显著提升了系统的可观测性与调试效率。</p><h4 id="计数样例-counters-demo" tabindex="-1"><a class="header-anchor" href="#计数样例-counters-demo"><span>计数样例（Counters Demo）</span></a></h4><p>各工作节点的计数器值会周期性地通过 ping 响应捎带传送到主节点。主节点汇总所有成功执行的 map 和 reduce 任务的计数器值，并在 MapReduce 作业完成后将其返回给用户代码。当前的计数器值也会显示在主控的状态页面上，供用户实时观察计算进度。在聚合过程中，主控会消除相同任务重复执行带来的重复计数，以避免统计偏差（此类重复可能源于备份任务或故障重试）。部分计数器由 MapReduce 库自动维护，例如处理的输入键值对数量和生成的输出键值对数量。用户常利用计数器功能进行合理性校验，例如验证输出对数量是否等于输入对数量，或检查处理的德语文档占比是否在可接受范围内，从而确保作业行为符合预期。</p><p>下面是另一个计数的例子</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">// 自定义计数器（由框架支持）</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">Counter</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">*</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> error_line_counter</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> map</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> key</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> value)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">    // key: 文档名或偏移量（通常忽略）</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">    // value: 一行文本</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">    // 分词并输出 &lt;word, &quot;1&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">    vector</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&lt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">String</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&gt;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> words </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> split</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(value</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;"> &quot; &quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">    for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">String</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> word </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> words) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">        EmitIntermediate</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(word</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#FFD493;"> &quot;1&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">}</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> reduce</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;">String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> key</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ACAFFF;"> Iterator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;"> values)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> {</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">    // key: 单词</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">    // values: 所有 &quot;1&quot; 的列表</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">    int</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> sum </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#FFD493;"> 0</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">    for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;"> (</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;"> !</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;">values</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">done</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">();</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;"> values</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">next</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">()</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">        sum </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> StringToInt</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#4BF3C8;">values</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">value</span><span style="--shiki-light:#6F42C1;--shiki-dark:#EEF0F9;">()</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">)</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">    Emit</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(key</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> IntToString</span><span style="--shiki-light:#6F42C1;--shiki-dark:#4BF3C8;">(sum))</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-2cd3122f data-v-1b3b956f><!--[--><!--]--><!----><!----><nav class="prev-next" data-v-1b3b956f><div class="pager" data-v-1b3b956f><a class="vp-link link pager-link prev" href="/distsys/cv7rbt64/" data-v-1b3b956f><!--[--><span class="desc" data-v-1b3b956f>上一页</span><span class="title" data-v-1b3b956f><!----><span data-v-1b3b956f>容错虚拟机</span></span><!--]--><!----></a></div><div class="pager" data-v-1b3b956f><a class="vp-link link pager-link next" href="/distsys/huqj63jd/" data-v-1b3b956f><!--[--><span class="desc" data-v-1b3b956f>下一页</span><span class="title" data-v-1b3b956f><!----><span data-v-1b3b956f>Raft</span></span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-9ec8d5cc style="display:none;" data-v-5a7e17b5><span class="percent" data-allow-mismatch data-v-5a7e17b5>0%</span><span class="show icon vpi-back-to-top" data-v-5a7e17b5></span><svg aria-hidden="true" data-v-5a7e17b5><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-5a7e17b5></circle></svg></button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="sign down" class="vp-sign-down" aria-hidden="true" data-v-9ec8d5cc style="display:none;" data-v-a78f69e5><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" data-v-a78f69e5><path d="m19 11l-7 6l-7-6" data-v-a78f69e5></path><path d="m19 5l-7 6l-7-6" opacity="0.6" data-v-a78f69e5></path></g></svg><footer class="vp-footer has-sidebar" vp-footer data-v-9ec8d5cc data-v-383d747a><!--[--><div class="container" data-v-383d747a><p class="message" data-v-383d747a>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-BChvZF5M.js" defer></script></body></html>