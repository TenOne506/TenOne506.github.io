import{_ as s,c as a,e as n,o as t}from"./app-BChvZF5M.js";const l={};function e(h,i){return t(),a("div",null,[...i[0]||(i[0]=[n(`<h3 id="string-view" tabindex="-1"><a class="header-anchor" href="#string-view"><span>string_view</span></a></h3><p>提供视图，仅提供指针和长度，不提供拷贝。要注意变量析构，悬空引用问题。</p><h3 id="operator-vs-strcat" tabindex="-1"><a class="header-anchor" href="#operator-vs-strcat"><span>operator+ vs StrCat()</span></a></h3><p>尽量使用函数，可能在两个字符串拼接时没有区别，但是在多个字符串拼接时 operator+()会创建大量临时对象，StrCat()会先计算长度，一次性申请内存进行拼接。</p><h3 id="避免消失" tabindex="-1"><a class="header-anchor" href="#避免消失"><span>避免消失</span></a></h3><ul><li>在完整表达式结束前完成临时对象的使用<div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-c++"><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // Safe (albeit a silly example):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  size_t</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> len1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> strlen</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">((s1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2)</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">c_str</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">());</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  size_t</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> len2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> strlen</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ACAFFF;">absl</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">StrCat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(s1</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2)</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">c_str</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>存储临时对象<div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-c++"><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // Safe (and more efficient than you might think):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">  std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string tmp_1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">  std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string tmp_2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> absl</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">StrCat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(s1</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // tmp_1.c_str() and tmp_2.c_str() are safe.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>存储对临时对象的引用。<div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" style="--shiki-light:#24292eff;--shiki-dark:#eef0f9;--shiki-light-bg:#ffffff;--shiki-dark-bg:#17191e;"><pre class="shiki shiki-themes min-light houston vp-code"><code class="language-c++"><span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">// Equally safe:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&amp;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> tmp_1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">+</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&amp;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> tmp_2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> absl</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">StrCat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">(s1</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> s2);</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // tmp_1.c_str() and tmp_2.c_str() are safe.</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // The following behavior is dangerously subtle:</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // If the compiler can see you’re storing a reference to a</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // temporary object’s internals, it will keep the whole</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // temporary object alive.</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // struct Person { string name; ... }</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // GeneratePerson() returns an object; GeneratePerson().name</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // is clearly a sub-object:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&amp;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> person_name </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> GeneratePerson</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">()</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#4BF3C8;">name</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">;</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;"> // safe</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // If the compiler can’t tell, you’re at risk.</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // class DiceSeries_DiceRoll { \`const string&amp;\` nickname() ... }</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // GenerateDiceRoll() returns an object; the compiler can’t tell</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // if GenerateDiceRoll().nickname() is a subobject.</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;">  // The following may store a dangling reference:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">  const</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> std</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">::</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">string</span><span style="--shiki-light:#D32F2F;--shiki-dark:#EEF0F9;">&amp;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;"> nickname </span><span style="--shiki-light:#D32F2F;--shiki-dark:#54B9FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;"> GenerateDiceRoll</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">()</span><span style="--shiki-light:#212121;--shiki-dark:#EEF0F9;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#00DAEF;">nickname</span><span style="--shiki-light:#24292EFF;--shiki-dark:#EEF0F9;">();</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#EEF0F98F;--shiki-dark-font-style:italic;"> // BAD!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>正常的类设计，肯定不会直接暴露成员变量的。这里例子就是提醒通过函数暴露成员引用这样可能会</li></ul><div class="hint-container important"><p class="hint-container-title">生命周期</p><p>引用绑定的临时或作为子对象完整对象的临时，在该引用的生命周期内持续存在。</p></div>`,7)])])}const F=s(l,[["render",e]]),p=JSON.parse('{"path":"/tipsissue/xh3bu7eo/","title":"C++-tips","lang":"zh-CN","frontmatter":{"title":"C++-tips","createTime":"2025/12/24 12:07:24","permalink":"/tipsissue/xh3bu7eo/"},"readingTime":{"minutes":1.36,"words":408},"git":{"createdTime":1766550151000},"filePathRelative":"tips/C++-tips.md","headers":[],"categoryList":[]}');export{F as comp,p as data};
